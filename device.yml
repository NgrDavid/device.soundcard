%YAML 1.1
---
# yaml-language-server: $schema=https://harp-tech.org/draft-02/schema/device.json
device: SoundCard
whoAmI: 1280
firmwareVersion: "3.0"
hardwareTargets: "1.1"
registers:
  PlaySoundOrFrequency: &frequency
    address: 32
    type: U16
    access: Write
    description: Starts the sound index (if less than 32) or frequency (if greater or equal than 32)
  Stop:
    address: 33
    type: U8
    access: Write
    description: Any value will stop the frequency generation (not implemented for a sound index)
  AttenuationLeft: &attenuation
    address: 34
    type: U16
    access: Write
    description: Configure left channel's attenuation (1 LSB is 0.1dB)
  AttenuationRight:
    <<: *attenuation
    address: 35
    description: Configure right channel's attenuation (1 LSB is 0.1dB)
  AttenuationBoth:
    <<: *attenuation
    address: 36
    length: 2
    description: Configures both attenuation on right and left channels [Att R] [Att L] (1 LSB is 0.1dB)
  AttenuationAndPlaySoundOrFreq:
    <<: *attenuation
    address: 37
    length: 3
    description: Configures attenuation and plays sound index or frequency [Att R] [Att L] [Index]
  Reserved0: &reserved
    address: 38
    type: U8
    access: Read
    description: Reserved for future use
    visibility: private
  Reserved1:
    <<: *reserved
    address: 39
  InputState:
    address: 40
    type: U8
    access: Event
    maskType: DigitalInputs
    description: State of the digital inputs
  ConfigureDI0: &configureDI
    address: 41
    type: U8
    access: Write
    maskType: DigitalInputConfiguration
    description: Configuration of the digital input 0 (DI0)
  ConfigureDI1:
    <<: *configureDI
    address: 42
    description: Configuration of the digital input 1 (DI1)
  SoundIndexDI0: &soundIndex
    address: 43
    type: U8
    access: Write
    description: Specifies the sound index to be played when triggering DI0
  SoundIndexDI1:
    <<: *soundIndex
    address: 44
    description: Specifies the sound index to be played when triggering DI1
  FrequencyDI0:
    <<: *frequency
    address: 45
    description: Specifies the sound frequency to be played when triggering DI0
  FrequencyDI1:
    <<: *frequency
    address: 46
    description: Specifies the sound frequency to be played when triggering DI1
  AttenuationLeftDI0:
    <<: *attenuation
    address: 47
    description: Left channel's attenuation (1 LSB is 0.1dB) when triggering DI0
  AttenuationLeftDI1:
    <<: *attenuation
    address: 48
    description: Left channel's attenuation (1 LSB is 0.1dB) when triggering DI1
  AttenuationRightDI0:
    <<: *attenuation
    address: 49
    description: Right channel's attenuation (1 LSB is 0.1dB) when triggering DI0
  AttenuationRightDI1:
    <<: *attenuation
    address: 50
    description: Right channel's attenuation (1 LSB is 0.1dB) when triggering DI1
  AttenuationAndSoundIndexDI0:
    <<: *attenuation
    address: 51
    length: 3
    description: Sound index and attenuation to be played when triggering DI0 [Att R] [Att L] [Index]
  AttenuationAndSoundIndexDI1:
    <<: *attenuation
    address: 52
    length: 3
    description: Sound index and attenuation to be played when triggering DI1 [Att R] [Att L] [Index]
  AttenuationAndFrequencyDI0:
    <<: *attenuation
    address: 53
    length: 2
    description: Sound index and attenuation to be played when triggering DI0 [Att BOTH] [Frequency]
  AttenuationAndFrequencyDI1:
    <<: *attenuation
    address: 54
    length: 2
    description: Sound index and attenuation to be played when triggering DI1 [Att BOTH] [Frequency]
  Reserved2:
    <<: *reserved
    address: 55
  Reserved3:
    <<: *reserved
    address: 56
  Reserved4:
    <<: *reserved
    address: 57
  ConfigureDO0: &configureDO
    address: 58
    type: U8
    access: Write
    maskType: DigitalOutputConfiguration
    description: Configuration of the digital output 0 (DO0)
  ConfigureDO1:
    <<: *configureDO
    address: 59
    description: Configuration of the digital output 1 (DO1)
  ConfigureDO2:
    <<: *configureDO
    address: 60
    description: Configuration of the digital output 2 (DO2
  Reserved5:
    <<: *reserved
    address: 61
  Reserved6:
    <<: *reserved
    address: 62
  Reserved7:
    <<: *reserved
    address: 63
  OutputSet: &output
    address: 64
    type: U8
    access: Write
    maskType: DigitalOutputs
    description: Set the specified digital output lines
  OutputClear:
    <<: *output
    address: 65
    description: Clear the specified digital output lines
  OutputToggle:
    <<: *output
    address: 66
    description: Toggle the specified digital output lines
  OutputState:
    <<: *output
    address: 67
    description: Write the state of all digital output lines
  Reserved8:
    <<: *reserved
    address: 68
  Reserved9:
    <<: *reserved
    address: 69
  ConfigureAdc:
    address: 70
    type: U8
    access: Write
    maskType: AdcConfiguration
    description: Configuration of Analog Inputs
  AnalogData:
    address: 71
    type: U16
    access: Event
    length: 5
    description: Contains sampled analog input data or dynamic sound parameters controlled by the ADC channels. Values are zero if not used.
    payloadSpec:
      Adc0:
        offset: 0
        description: The sampled analog input value on ADC0.
      Adc1:
        offset: 1
        description: The sampled analog input value on ADC1.
      AttenuationLeft:
        offset: 2
        description: The amplitude of the left channel controlled by ADC0.
      AttenuationRight:
        offset: 3
        description: The amplitude of the right channel controlled by ADC0.
      Frequency:
        offset: 4
        description: The output frequency controlled by ADC1.
  Commands:
    address: 72
    type: U8
    access: Write
    maskType: ControllerCommand
    description: Send commands to PIC32 micro-controller
  Reserved10:
    <<: *reserved
    address: 73
  Reserved11:
    <<: *reserved
    address: 74
  Reserved12:
    <<: *reserved
    address: 75
  EnableEvents:
    address: 76
    type: U8
    access: Write
    maskType: SoundCardEvents
    description: Specifies the active events in the SoundCard device
bitMasks:
  DigitalInputs:
    description: Specifies the state of the digital input lines.
    bits:
      DI0: {value: 1, description: Digital input 0.}
      DI1: {value: 2, description: Digital input 1.}
      DI2: {value: 4, description: Digital input 2 (don't have associated event).}
  DigitalOutputs:
    description: Specifies the state of the digital output lines.
    bits:
      DO0: {value: 1, description: Digital output 0.}
      DO1: {value: 2, description: Digital output 1.}
      DO2: {value: 4, description: Digital output 2.}
  SoundCardEvents:
    description: Specifies the active events in the SoundCard.
    bits:
      PlaySoundOrFrequency: 0x1
      Stop: 0x2
      DigitalInputs: 0x4
      AdcValues: 0x8
groupMasks:
  DigitalInputConfiguration:
    description: Specifies the operation mode of the digital input.
    values:
      Digital: {value: 0, description: Used as a pure digital input.}
      StartAndStopSound: {value: 1, description: Starts sound index (if less than 32) or frequency (if greater or equal than 32) when rising edge and stop when falling edge.}
      StartSound: {value: 2, description: Starts sound index (if less than 32) or frequency (if greater or equal than 32) when rising edge.}
      StopSound: {value: 3, description: Stops frequency when falling edge.}
  DigitalOutputConfiguration:
    description: Specifies the operation mode of the digital output.
    values:
      Digital: {value: 0, description: Used as a pure digital output.}
      HighWhenSound: {value: 2, description: High when the sound is being played. }
  ControllerCommand:
    description: Specifies commands to send to the PIC32 micro-controller
    values:
      DisableBootloader: 0
      EnableBootloader: 1
      DeleteAllSounds: 255
  AdcConfiguration:
    description: Specifies the operation mode of the analog inputs.
    values:
      NotUsed: 0
      AdcAdc: 1
      AmplitudeBothAdc: 2
      AmplitudeLeftAdc: 3
      AmplitudeRightAdc: 4
      AmplitudeLeftAmplitudeRight: 5
      AmplitudeBothFrequency: 6
